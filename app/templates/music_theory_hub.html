{% extends "base.html" %}
{% block title %}Music Theory Hub - Music Education Website{% endblock %}
{% block content %}
<h2>Interactive Music Theory Tools</h2>
<p>Explore our interactive tools to learn music theory in an engaging way. Practice scales, chords, and ear training exercises to improve your understanding of music fundamentals.</p>

<div class="note-guessing mt-5">
    <h3>Note Guessing Game</h3>
    <p>Listen to a note and try to guess which note it is. Click the button to play a note and type your answer.</p>
    <button onclick="playRandomNote()" class="btn btn-primary">Play Note</button>
</div>

<div class="chord-sequence mt-5">
    <h3>Next Note in Chord Sequence</h3>
    <p>Listen to a chord sequence and guess the next note in the sequence. Click the button to hear the sequence and type your answer.</p>
    <button onclick="playChordSequence()" class="btn btn-primary">Play Chord Sequence</button>
</div>

<div class="scales-trainer mt-5">
    <h3>Interactive Scales Trainer</h3>
    <p>Use the interactive scales trainer to practice playing different scales and see how they sound. Select a scale and click through the notes to follow along.</p>
    <label for="scale-select">Choose a scale:</label>
    <select id="scale-select">
        <option value="C_major">C Major</option>
        <option value="G_major">G Major</option>
        <option value="A_minor">A Minor</option>
    </select>
    <button onclick="playSelectedScale()" class="btn btn-primary mt-3">Play Selected Scale</button>
</div>

<script>
    function playSelectedScale() {
        const scale = document.getElementById('scale-select').value;
        playScale(scale);
    }

    function playScale(scale) {
        const scales = {
            'C_major': ['C', 'D', 'E', 'F', 'G', 'A', 'B', 'C'],
            'G_major': ['G', 'A', 'B', 'C', 'D', 'E', 'F#', 'G'],
            'A_minor': ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'A']
        };

        let delay = 0;
        scales[scale].forEach(note => {
            setTimeout(() => playNote(note), delay);
            delay += 500; // 500 ms between notes
        });
    }

    function playRandomNote() {
        const notes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
        const randomNote = notes[Math.floor(Math.random() * notes.length)];
        playNoteWithIfStatement(randomNote);

        setTimeout(() => {
            const userAnswer = prompt('What note did you hear?');
            if (randomNote === 'C' && userAnswer.toLowerCase() === 'c') {
                alert('Correct!');
            } else if (randomNote === 'D' && userAnswer.toLowerCase() === 'd') {
                alert('Correct!');
            } else if (randomNote === 'E' && userAnswer.toLowerCase() === 'e') {
                alert('Correct!');
            } else if (randomNote === 'F' && userAnswer.toLowerCase() === 'f') {
                alert('Correct!');
            } else if (randomNote === 'G' && userAnswer.toLowerCase() === 'g') {
                alert('Correct!');
            } else if (randomNote === 'A' && userAnswer.toLowerCase() === 'a') {
                alert('Correct!');
            } else if (randomNote === 'B' && userAnswer.toLowerCase() === 'b') {
                alert('Correct!');
            } else {
                alert(`Incorrect. The correct answer was: ${randomNote}`);
            }
        }, 1000);
    }

    function playNoteWithIfStatement(note) {
        let audioFile = '';
        if (note === 'C') {
            audioFile = 'piano-c_C_major.wav';
        } else if (note === 'D') {
            audioFile = 'piano-d.wav';
        } else if (note === 'E') {
            audioFile = 'piano-e.wav';
        } else if (note === 'F') {
            audioFile = 'piano-f.wav';
        } else if (note === 'G') {
            audioFile = 'piano-g.wav';
        } else if (note === 'A') {
            audioFile = 'piano-a.wav';
        } else if (note === 'B') {
            audioFile = 'piano-b.wav';
        }

        const audio = new Audio(`/static/audio/${audioFile}`);
        audio.play().catch(error => {
            console.error(`Error playing note ${note}:`, error);
        });
    }

    function playChordSequence() {
        const sequences = [
            {
                notes: ['C', 'E', 'G'],
                nextNote: 'C'
            },
            {
                notes: ['G', 'B', 'D'],
                nextNote: 'G'
            },
            {
                notes: ['A', 'C', 'E'],
                nextNote: 'A'
            }
        ];

        const randomIndex = Math.floor(Math.random() * sequences.length);
        const sequence = sequences[randomIndex];

        sequence.notes.forEach((note, index) => {
            setTimeout(() => playNoteWithIfStatement(note), index * 1000);
        });

        setTimeout(() => {
            const userAnswer = prompt('What is the next note in the sequence?');
            if (userAnswer.toLowerCase() === sequence.nextNote.toLowerCase()) {
                alert('Correct!');
            } else {
                alert(`Incorrect. The correct answer was: ${sequence.nextNote}`);
            }
        }, sequence.notes.length * 1000 + 500);
    }
</script>

<style>
    .piano {
        display: flex;
        justify-content: center;
        width: 600px;
        margin: 0 auto;
    }

    .white-key {
        width: 60px;
        height: 200px;
        background: white;
        border: 1px solid black;
        position: relative;
    }

    .black-key {
        width: 40px;
        height: 120px;
        background: black;
        position: absolute;
        margin-left: -20px;
        z-index: 1;
    }

    .black-key[data-note="C#"], .black-key[data-note="D#"], .black-key[data-note="F#"], .black-key[data-note="G#"], .black-key[data-note="A#"] {
        left: 40px;
    }

    .chords-library button {
        margin: 5px;
    }
</style>
{% endblock %}
